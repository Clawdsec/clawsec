# SSH Security Rules
# Protects SSH credentials and dangerous operations

name: ssh-security
description: Security rules for SSH access and credentials
version: "1.0"

rules:
  secrets:
    enabled: true
    severity: critical
    action: block
    patterns:
      # SSH private keys
      - "-----BEGIN OPENSSH PRIVATE KEY-----"
      - "-----BEGIN RSA PRIVATE KEY-----"
      - "-----BEGIN DSA PRIVATE KEY-----"
      - "-----BEGIN EC PRIVATE KEY-----"
      - "-----BEGIN PRIVATE KEY-----"

      # SSH passwords
      - "SSH_PASSWORD"
      - "SSH_PASS"
      - "sshpass"

      # SSH agent
      - "SSH_AUTH_SOCK"
      - "SSH_AGENT_PID"

      # Known hosts manipulation
      - "StrictHostKeyChecking=no"
      - "UserKnownHostsFile=/dev/null"

  destructive:
    enabled: true
    severity: high
    action: confirm
    shell:
      enabled: true
      patterns:
        # Dangerous SSH commands
        - "ssh.*rm -rf"
        - "ssh.*mkfs"
        - "ssh.*dd if="
        - "ssh.*:(){:|:&};:"  # Fork bomb

        # Key operations
        - "ssh-keygen -R"  # Remove from known_hosts
        - "rm.*id_rsa"
        - "rm.*id_ed25519"
        - "rm.*.ssh/"

        # Config modifications
        - "chmod.*600.*authorized_keys"

  exfiltration:
    enabled: true
    severity: high
    action: block
    patterns:
      # SSH tunneling for exfiltration
      - "ssh.*-R"
      - "ssh.*-L"
      - "ssh.*-D"
      - "sshfs"
      - "rsync.*-e ssh"
